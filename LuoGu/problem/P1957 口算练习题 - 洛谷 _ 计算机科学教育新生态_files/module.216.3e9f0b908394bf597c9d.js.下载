(window.webpackJsonp=window.webpackJsonp||[]).push([[216],{1101:function(e,t,r){},1377:function(e,t,r){"use strict";r(1101)},1527:function(e,t,r){"use strict";r.r(t);var a=r(4),n=r.n(a),o=r(13),s=r.n(o),i=r(967),l=r(165),u=r(11),c=r(9),d=r(6),p=r(2);d.c.add(p.hb);var m={components:{LLink:u.n,LBadge:u.a,LButton:u.b,LFreeButton:u.j,LStats:u.x,LUserName:u.E,LInputGroup:u.m,LCombo:u.f,LRadio:u.t,HeaderLayout:i.a,DropdownWrapper:l.a},props:{currentData:{type:Object,required:!0},currentTemplate:{type:String,required:!0},currentUser:{type:Object,default:null}},meta(){return{title:this.problemTitle}},data:()=>({bookmarking:!1,requesting:!1,removingFromBookmark:!1,cloneToTeam:null,loadingTrainings:!1,userOwnedTrainings:[],teamOwnedTrainings:[],addToType:null,addToTeam:null,addToTraining:null}),computed:{stats(){return[{key:"提交",value:Object(c.g)(this.problem.totalSubmit)},{key:"通过",value:Object(c.g)(this.problem.totalAccepted)},{key:"时间限制",value:0!==this.problem.limits.time.length?Object(c.h)(this.problem.limits.time,c.j):"无数据"},{key:"内存限制",value:0!==this.memoryLimit.length?Object(c.h)(this.memoryLimit,c.i):"无数据"}]},problemTitle(){return"".concat(this.problem.pid," ").concat(this.problem.title)},problem(){return this.currentData.problem},memoryLimit(){return this.problem.limits.memory.map((e=>1024*e))},privilegedTeams(){return(this.currentData.privilegedTeams||[]).map((e=>({value:e.id,label:e.name})))},showSubmitBlock(){return"#submit"===this.$route.hash&&this.currentUser},showTranslationBlock(){return"#translate"===this.$route.hash&&this.currentUser&&this.problem.wantsTranslation},isAddTrainingSave(){return"team"===this.addToType?this.addToTeam&&this.addToTraining:"user"===this.addToType?this.addToTraining:this.addToType}},watch:{"currentData.bookmarked"(){this.addToType=null},addToType(e){"team"===e?(this.addToTeam=null,this.teamOwnedTrainings=[]):"user"===e&&this.userOwnedTrainings.length<1&&this.loadUserOwnedTrainings(),this.addToTraining=null},addToTeam(){this.loadTeamOwnedTrainings()}},methods:{doBookmark(e){var t=this;return s()(n.a.mark((function r(){var a;return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.$lfeGetRoute({name:"api.problem.tasklist_".concat(e?"add":"remove")});case 2:return a=r.sent,r.next=5,Object(c.n)(a.href,{pid:t.problem.pid});case 5:t.$set(t.currentData,"bookmarked",e),t.$swalToastSuccess("成功将题目".concat(e?"加入":"移出","任务列表"));case 7:case"end":return r.stop()}}),r)})))()},removeBookmark(){var e=this;return s()(n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.removingFromBookmark){t.next=2;break}return t.abrupt("return");case 2:return e.removingFromBookmark=!0,t.prev=3,t.next=6,e.doBookmark(!1);case 6:t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(3),t.next=12,e.$generalRequestExceptionCatcher(t.t0,{toast:!0});case 12:e.removingFromBookmark=!1;case 13:case"end":return t.stop()}}),t,null,[[3,8]])})))()},addTo(){var e=this;return s()(n.a.mark((function t(){var r;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.requesting){t.next=2;break}return t.abrupt("return");case 2:if(e.requesting=!0,t.prev=3,"bookmark"!==e.addToType){t.next=9;break}return t.next=7,e.doBookmark(!0);case 7:t.next=15;break;case 9:return t.next=11,e.$lfeGetRoute({name:"api.training.add_problem",params:{id:e.addToTraining}});case 11:return r=t.sent,t.next=14,Object(c.n)(r.href,{pids:[e.problem.pid]});case 14:e.$swalToastSuccess("添加成功");case 15:t.next=21;break;case 17:return t.prev=17,t.t0=t.catch(3),t.next=21,e.$generalRequestExceptionCatcher(t.t0,{toast:!0});case 21:e.requesting=!1;case 22:case"end":return t.stop()}}),t,null,[[3,17]])})))()},loadUserOwnedTrainings(){var e=this;return s()(n.a.mark((function t(){var r,a,o;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loadingTrainings=!0,t.prev=1,t.next=4,e.$lfeGetRoute({name:"api.user.created_trainings"});case 4:return r=t.sent,t.next=7,Object(c.m)(r.href);case 7:a=t.sent,o=a.trainings,e.userOwnedTrainings=o.result.map((e=>({value:e.id,label:e.title}))),t.next=16;break;case 12:return t.prev=12,t.t0=t.catch(1),t.next=16,e.$generalRequestExceptionCatcher(t.t0,{toast:!0});case 16:e.loadingTrainings=!1;case 17:case"end":return t.stop()}}),t,null,[[1,12]])})))()},loadTeamOwnedTrainings(){var e=this;return s()(n.a.mark((function t(){var r,a,o;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.addToTeam){t.next=2;break}return t.abrupt("return");case 2:return e.loadingTrainings=!0,t.prev=3,t.next=6,e.$lfeGetRoute({name:"api.team.trainings",params:{id:e.addToTeam}});case 6:return r=t.sent,t.next=9,Object(c.m)(r.href);case 9:a=t.sent,o=a.trainings,e.teamOwnedTrainings=o.result.map((e=>({value:e.id,label:e.title}))),t.next=18;break;case 14:return t.prev=14,t.t0=t.catch(3),t.next=18,e.$generalRequestExceptionCatcher(t.t0,{toast:!0});case 18:e.loadingTrainings=!1;case 19:case"end":return t.stop()}}),t,null,[[3,14]])})))()},cloneTo(){var e=this;return s()(n.a.mark((function t(){var r,a,o;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.cloneToTeam){t.next=2;break}return t.abrupt("return");case 2:if(!e.requesting){t.next=4;break}return t.abrupt("return");case 4:return e.requesting=!0,t.prev=5,t.next=8,e.$lfeGetRoute({name:"api.problem.transfer",params:{pid:e.currentData.problem.pid}});case 8:return r=t.sent,t.next=11,Object(c.n)(r.href,{operation:"clone",type:"T",teamID:e.cloneToTeam});case 11:a=t.sent,o=a.pid,e.$swalSuccess("复制成功",null,{showConfirmButton:!1,timer:1e3}),e.$router.push({name:"problem.show",params:{pid:o}}),t.next=21;break;case 17:return t.prev=17,t.t0=t.catch(5),t.next=21,e.$generalRequestExceptionCatcher(t.t0,{title:"复制失败"});case 21:e.requesting=!1;case 22:case"end":return t.stop()}}),t,null,[[5,17]])})))()}}},T=(r(1377),r(10)),b=Object(T.a)(m,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("header-layout",e._g(e._b({},"header-layout",e.$props,!1),e.$listeners),[r("template",{slot:"title"},[e._v(e._s(e.problemTitle))]),e._v(" "),e.currentUser?e.showSubmitBlock||e.showTranslationBlock?r("l-button",{attrs:{slot:"op",solid:""},on:{click:function(t){return e.$router.replace({hash:"",query:e.$route.query})}},slot:"op"},[e._v("\n    返回题目\n  ")]):[r("l-button",{attrs:{slot:"op",solid:""},on:{click:function(t){return e.$router.replace({hash:"#submit",query:e.$route.query})}},slot:"op"},[e._v("\n      提交答案\n    ")]),e._v(" "),e.currentUser?r("dropdown-wrapper",{attrs:{slot:"op",align:"center",inline:""},slot:"op"},[r("l-free-button",{staticClass:"button-in-anchor",attrs:{slot:"trigger"},slot:"trigger"},[e._v("\n        加入题单\n      ")]),e._v(" "),r("div",{staticClass:"clone-card",attrs:{slot:"dropdown"},slot:"dropdown"},[r("l-radio",{attrs:{disabled:e.currentData.bookmarked,value:"bookmark"},model:{value:e.addToType,callback:function(t){e.addToType=t},expression:"addToType"}},[e._v("做题计划（首页）")]),e._v(" "),e.currentData.bookmarked?r("span",{staticStyle:{"padding-left":"2em","font-size":".875em"}},[e._v("\n          您已将该题目添加进了做题计划。\n          "),r("l-button",{attrs:{disabled:e.removingFromBookmark,size:"small"},on:{click:e.removeBookmark}},[e._v("点击移除")])],1):e._e(),e._v(" "),r("l-radio",{attrs:{value:"user"},model:{value:e.addToType,callback:function(t){e.addToType=t},expression:"addToType"}},[e._v("个人题单")]),e._v(" "),"user"===e.addToType?r("l-combo",{attrs:{options:e.userOwnedTrainings,disabled:e.loadingTrainings,size:"small"},model:{value:e.addToTraining,callback:function(t){e.addToTraining=t},expression:"addToTraining"}},[e.loadingTrainings?[e._v("\n            正在加载\n            "),r("font-awesome-icon",{attrs:{icon:"spinner-third",spin:""}})]:[e._v("\n            选择题单\n          ")]],2):e._e(),e._v(" "),r("l-radio",{attrs:{value:"team"},model:{value:e.addToType,callback:function(t){e.addToType=t},expression:"addToType"}},[e._v("团队题单")]),e._v(" "),"team"===e.addToType?r("l-combo",{attrs:{options:e.privilegedTeams,disabled:e.loadingTrainings,size:"small",placeholder:"选择团队"},model:{value:e.addToTeam,callback:function(t){e.addToTeam=t},expression:"addToTeam"}}):e._e(),e._v(" "),"team"===e.addToType?r("l-combo",{attrs:{options:e.teamOwnedTrainings,disabled:e.loadingTrainings,size:"small"},model:{value:e.addToTraining,callback:function(t){e.addToTraining=t},expression:"addToTraining"}},[e.loadingTrainings?[e._v("\n            正在加载\n            "),r("font-awesome-icon",{attrs:{icon:"spinner-third",spin:""}})]:[e._v("\n            选择题单\n          ")]],2):e._e(),e._v(" "),r("l-button",{attrs:{disabled:e.requesting||!e.isAddTrainingSave,color:"primary",solid:""},on:{click:e.addTo}},[e._v("\n          保存\n          "),e.requesting?r("font-awesome-icon",{attrs:{icon:"spinner-third",spin:""}}):e._e()],1)],1)],1):e._e(),e._v(" "),!e.currentData.clonedFrom&&e.privilegedTeams.length>0?r("template",{slot:"op"},[r("dropdown-wrapper",{attrs:{align:"center",inline:""}},[r("l-free-button",{staticClass:"button-in-anchor",attrs:{slot:"trigger"},slot:"trigger"},[e._v("\n          复制题目\n        ")]),e._v(" "),r("div",{staticClass:"clone-card",attrs:{slot:"dropdown"},slot:"dropdown"},[r("l-combo",{attrs:{options:e.privilegedTeams,size:"small",placeholder:"选择团队"},model:{value:e.cloneToTeam,callback:function(t){e.cloneToTeam=t},expression:"cloneToTeam"}}),e._v(" "),r("l-button",{attrs:{disabled:e.requesting||!e.cloneToTeam,color:"primary",solid:""},on:{click:e.cloneTo}},[e._v("\n            保存\n            "),e.requesting?r("font-awesome-icon",{attrs:{icon:"spinner-third",spin:""}}):e._e()],1)],1)],1)],1):e._e(),e._v(" "),e.problem.canEdit?r("l-link",{attrs:{slot:"op",to:{name:"problem.edit",params:{pid:e.problem.pid}},blank:""},slot:"op"},[r("l-free-button",{staticClass:"button-in-anchor"},[e._v("\n        编辑题目\n      ")])],1):e._e()]:r("l-button",{attrs:{slot:"op",solid:"",disabled:""},slot:"op"},[e._v("\n    登录后才可提交\n  ")]),e._v(" "),r("l-stats",{attrs:{slot:"stat",fields:e.stats,"color-scheme":"inverse"},slot:"stat"})],2)}),[],!1,null,"42c20b13",null);t.default=b.exports},967:function(e,t,r){"use strict";var a=r(11),n=r(162),o={components:{TheHeaderLayout:a.I,UserNav:n.a},props:{layout:{type:[String,Object],default:"normal"},currentUser:{type:Object,default:null},currentTemplate:{type:String,default:null},pageName:{type:String,default:null}}},s=r(10),i=Object(s.a)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("the-header-layout",e._g(e._b({},"the-header-layout",e.$props,!1),e.$listeners),[r("user-nav",{attrs:{slot:"user-nav",user:e.currentUser},slot:"user-nav"}),e._v(" "),e._t("title",null,{slot:"title"}),e._v(" "),e._t("stat",null,{slot:"stat"}),e._v(" "),e._t("op",null,{slot:"op"})],2)}),[],!1,null,null,null);t.a=i.exports}}]);